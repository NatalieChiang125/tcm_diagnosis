
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>中醫問診系統</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fdfaf5;
      padding: 30px;
      line-height: 1.6;
    }

    h1 {
      color: #8B0000;
      font-size: 2em;
      margin-bottom: 10px;
    }

    .subheading {
      font-size: 0.9em;
      color: #555;
      margin-top: -10px;
      margin-bottom: 20px;
    }
    .subdevise{
      font-size: 0.8em;
      color: #ec7063;
      margin-top: -10px;
      margin-bottom: 20px;
    }

    /*.explain-btn {
      margin-left: 5px;
      font-size: 0.8em;
      cursor: pointer;
      color: #007BFF;
      border: none;
      background: none;
      text-decoration: underline;
    }
    .explain-btn:hover {
      color: #0056b3;
    }*/

    .tooltip-wrapper {
      position: relative;
      display: inline-block;
    }

    .tooltip-text {
      display: none;
      position: absolute;
      left: 60%;
      top: 0;
      margin-left: 5px;
      padding: 5px 8px;
      background-color: #f2f2f2;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 5px;
      white-space: nowrap;
      z-index: 10;
      font-size: 0.85em;
    }
    
    .tooltip-wrapper.active .tooltip-text {
      display: inline-block;
    }

    .explain-btn {
      margin-left: 1px;
      background: none;
      border: none;
      padding: 0;
      color: #007BFF;
      cursor: pointer;
      font-size: 0.9em;
      font-family: inherit;
      line-height: 1;
      transition: color 0.3s ease;
    }

    .explain-btn:hover {
      color: #0056b3;       /* hover 時變色 */
    }

    .explain-btn:focus {
      outline: none;
      box-shadow: none;
    }


    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }

    .symptom-group {
      margin-bottom: 15px;
    }

    .symptom-group summary {
      font-weight: bold;
      color: #444;
      cursor: pointer;
    }

    label {
      display: inline-block;
      width: 45%;
      margin-bottom: 8px;
    }

    button {
      background-color: #aa463d;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #a53025;
    }

    .infobutton {
      background-color: #fff;
      color: #2e86c1;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      margin-right: 10px;
    }

    .infobutton:hover {
      background-color: #fff;
    }

    .step-tracker {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
    }

    .step {
      position: relative;
      display: flex;
      align-items: center;
    }

    .step-circle {
      width: 30px;
      height: 30px;
      background-color: #ddd;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      color: white;
      z-index: 1;
    }

    .step-circle.active {
      background-color: #aa463d;
    }

    .step-line {
      width: 60px;
      height: 4px;
      background-color: #ddd;
    }

    .step-line.active {
      background-color: #aa463d;
    }


    #result {
      font-size: 1.1em;
      color: #333;
    }

    .result-box {
      background: #f9f1ef;
      border-left: 5px solid #8B0000;
      padding: 15px;
      margin-top: 10px;
      border-radius: 5px;
    }

    .page {
      display: none;
      #page1 {
        display: block;
      }
    }

    .navigation-buttons {
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      label {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <div class="step-tracker" id="stepTracker">
    <div class="step">
      <div class="step-circle active" id="step1">1</div>
      <div class="step-line" id="line1"></div>
    </div>
    <div class="step">
      <div class="step-circle" id="step2">2</div>
      <div class="step-line" id="line2"></div>
    </div>
    <div class="step">
      <div class="step-circle" id="step3">3</div>
      <div class="step-line" id="line3"></div>
    </div>
    <div class="step">
      <div class="step-circle" id="step4">4</div>
      <div class="step-line" id="line4"></div>
    </div>
    <div class="step">
      <div class="step-circle" id="step5">5</div>
    </div>
  </div>

  <section id="page1" class="page" style="display: block; text-align: center;">
    <h1>請選擇系統</h1>
    <div style="display: flex; justify-content: center; gap: 50px; margin-top: 50px;">
      <div onclick="startCitizenSystem()" style="width: 200px; height: 200px; border: 2px solid #aa463d; border-radius: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
        <h2>民眾系統</h2>
      </div>
      <div onclick="startDoctorSystem()" style="width: 200px; height: 200px; border: 2px solid #466daa; border-radius: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
        <h2>醫師系統</h2>
      </div>
    </div>
  </section>

  <section id="page2" class="page" style="display: none;">
    <h1>中醫問診（依《傷寒論》）</h1>
    <p class="subheading"> 歡迎來到AI中醫辨證論治系統，請勾選下列您出現的症狀</p>
    <button onclick="showPage(3)">開始填寫基本資料</button>
  </section>


  <section id="page3" class="page" style="display:none;">
    <h1>基本資料填寫</h1>
    <form id="basicInfoForm">
      <label>性別：
        <select name="gender" required>
          <option value="">請選擇</option>
          <option value="男">男</option>
          <option value="女">女</option>
          <option value="其他">其他</option>
        </select>
      </label><br><br>

      <label>年齡：
        <input type="number" name="age" min="0" max="120" required>
      </label><br><br>

      <label>用藥史：
        <textarea name="medHistory" rows="3" placeholder="請簡述您過去的用藥情況"></textarea>
      </label><br><br>

      <button type="button" onclick="previousStep()">上一步</button>
      <button type="button" onclick="showPage(4)">下一步：症狀選擇</button>
    </form>
  </section>

  //加入疾病的項目(要刪掉)

  <section id="page4" class="page" style="display:none;">
    <form id="diagnosisForm" class="card">
      <details class="symptom-group" open>
        <summary>表證相關</summary>
        <label>
          <input type="checkbox" name="symptom" value="發熱"> 發熱
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">身體感覺發熱或體溫升高</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="發潮熱"> 潮熱
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">一天某些時段出現像海潮一樣的發熱</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="惡風"> 惡風
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">怕風，風吹即覺不適</span>
          </span>

        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="汗出"> 汗出
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">身體自然出汗，通常是微汗</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="無汗"> 無汗
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">身體沒有出汗</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="自汗"> 自汗
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">沒有活動或發熱，卻自然一直出汗</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="惡寒"> 惡寒
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">怕冷，甚至風吹就發抖，不易取暖</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="不惡寒"> 不惡寒
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">不怕冷</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="頭痛"> 頭痛
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">頭部疼痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="咳嗽"> 咳嗽
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">咳嗽</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="氣喘"> 氣喘
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">呼吸急促、呼吸不順，會感覺「氣不夠用」</span>
          </span>
        </label><br>
      </details>

      <details class="symptom-group">
        <summary>陽明/實熱證</summary>
        <label>
          <input type="checkbox" name="symptom" value="反惡熱"> 反惡熱
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">怕熱</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="臥起不安"> 臥起不安
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">躺下與起身都不舒服</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="四肢疼"> 四肢疼
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">四肢肌肉或關節部位感到疼痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="內拘急"> 內拘急
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">筋脈或肢體僵硬拘攣不舒，難以伸展或活動</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="胸中煩熱"> 胸中煩熱
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">胸部感覺內熱煩躁不安</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="身熱不去"> 身熱不去
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">持續發熱，熱勢不退</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="夜熱而渴"> 夜熱而渴
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">晚上發熱，並伴有口渴</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="少腹急結"> 少腹急結
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">下腹部硬硬的、緊繃不舒服，有壓痛感</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="少腹鞕滿"> 少腹鞕滿
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">小腹部位（肚臍以下）脹滿而堅硬</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="肛門灼熱"> 肛門灼熱
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">排便時肛門有燒灼感</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="腹滿"> 腹滿
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">腹部有脹滿感</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="心下鞕痛"> 心下鞕痛
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">上腹部堅硬且痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="心下痞鞕滿"> 心下痞鞕滿
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">上腹部除了疼痛，還有不舒服的脹滿感和結塊感</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="心下按之則痛"> 心下按之則痛
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">中上腹部壓下去會疼痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="身目發黃"> 身目發黃
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">全身與眼睛皮膚泛黃</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="身黃"> 身黃
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">全身皮膚泛黃</span>
          </span>
        </label><br>
      </details>

      <details class="symptom-group">
        <summary>少陽/半表半裏(內熱、胃腸實熱為主)</summary>
        <label>
          <input type="checkbox" name="symptom" value="胸脅苦滿"> 胸脅苦滿
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">胸部側面（肋骨下緣處）脹悶不舒、隱痛、情志不暢</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="胸中痞滿"> 胸中痞滿
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">胸部中央至膻中部悶脹感</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="引脅下痛"> 引脅下痛
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">疼痛由胸脅部牽引到肋骨下緣的部位</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="心下急"> 心下急
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">心窩處緊張疼痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="寒熱往來"> 寒熱往來
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">時而發熱，時而怕冷</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="心煩"> 心煩
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">心煩</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="身重"> 身重
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">身體沉重</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="咽燥"> 咽燥
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">咽喉乾燥</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="口苦"> 口苦
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">口中發苦</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="目眩"> 目眩
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">頭暈眼花</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="不能飲食"> 不能進食
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">本該有食慾，但反而不吃，不想吃、吃不下</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="不知食味"> 不知食味
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">食慾全無</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="大便困難"> 大便困難
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">無法順利排便</span>
          </span>
        </label><br>
      </details>

      <details class="symptom-group">
        <summary>太陰/虛寒(中焦虛寒)</summary>
        <label>
          <input type="checkbox" name="symptom" value="少腹脹滿證"> 少腹脹滿證
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">下腹部感到脹脹的，甚至發脹發悶、不舒服，有壓迫感或滿脹感，但不一定是疼痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="腹中痛"> 腹中痛
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">腹部疼痛</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="厥冷"> 厥冷
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">肢體冰冷比一般的惡寒更嚴重</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="厥逆"> 厥逆
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">氣血逆亂，造成肢體冰冷，脈象微弱，患者常感四肢冰冷或麻木</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="吐利"> 吐利
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">吐</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="下利"> 下利
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">腹瀉</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="乾嘔"> 乾嘔
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">想吐但吐不出東西</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="噎氣證"> 噎氣證
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">胸中阻塞，氣上不通，出現吞嚥不暢或氣噎感</span>
          </span>
        </label><br>
        
      </details>

      <details class="symptom-group">
        <summary>小便/水腫/腎臟相關</summary>
        <label>
          <input type="checkbox" name="symptom" value="小便不利"> 小便不利
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">小便不順</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="小便自利"> 小便自利
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">小便通暢、甚至偏多而無阻滯，但出現在一些「水腫不退」、「腹瀉」等病情</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="遺尿"> 遺尿
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">小便不自主、控制不了尿液而流出</span>
          </span>
        </label><br>
      </details>

      <details class="symptom-group">
        <summary>婦科 / 血瘀相關</summary>
        <label>
          <input type="checkbox" name="symptom" value="經水適來"> 經水適來
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">月經剛來</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="下血乃愈"> 下血乃愈
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">出血後病情改善</span>
          </span>
        </label><br>
        
      </details>

      <details class="symptom-group">
        <summary>神情、語言異常</summary>
        <label>
          <input type="checkbox" name="symptom" value="譫語"> 譫語
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">胡言亂語、說話顛三倒四、神志不清</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="言語譫妄"> 言語譫妄
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">胡言亂語</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="言語不利"> 言語不利
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">說話不流利、不清楚，或不太會講話</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="如狂"> 如狂
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">看起來像瘋了一樣，言語、行為失常，胡言亂語</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="發狂"> 發狂
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">神明失常、狂躁</span>
          </span>
        </label><br>
      </details>

      <details class="symptom-group">
        <summary>誤治</summary>
        <label>
          <input type="checkbox" name="symptom" value="服了桂枝湯，內熱擾心"> 服了桂枝湯，內熱擾心
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">出現心煩</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="服了桂枝湯，口渴嚴重"> 服了桂枝湯，口渴嚴重
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">喝很多水也無法緩解口渴</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="誤用攻下法"> 誤用攻下法
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">誤用瀉藥</span>
          </span>
        </label><br>
        <label>
          <input type="checkbox" name="symptom" value="誤用了燒針"> 誤用了燒針
          <span class="tooltip-wrapper">
            <button type="button" class="infobutton explain-btn" onclick="toggleTooltip(this)">ℹ</button>
            <span class="tooltip-text">誤用了燒針</span>
          </span>
        </label><br>
        
      </details>


      <button type="button" onclick="previousStep()">上一步</button>
      <button type="reset">清除重選</button>
      <button onclick="showPage(5)">下一步</button>
      
    </form>

  </section>

  <section id="page5" class="page" style="display:none;">
    <h1>脈象診斷</h1>
    <p class="subheading">請醫師勾選病人的脈象，系統將根據症狀與脈象判斷可能病症。</p>
    
    <form id="pulseForm">
      <label><input type="checkbox" name="pulse" value="浮脈"> 浮脈</label><br>
      <label><input type="checkbox" name="pulse" value="沉脈"> 沉脈</label><br>
      <label><input type="checkbox" name="pulse" value="緩脈"> 緩脈</label><br>
      <label><input type="checkbox" name="pulse" value="緩脈"> 緊脈</label><br>
      <label><input type="checkbox" name="pulse" value="數脈"> 數脈</label><br>
      <label><input type="checkbox" name="pulse" value="滑脈"> 滑脈</label><br>
      <label><input type="checkbox" name="pulse" value="澀脈"> 澀脈</label><br>
      <label><input type="checkbox" name="pulse" value="脈象洪大"> 脈象洪大</label><br>
      <label><input type="checkbox" name="pulse" value="脈象洪大"> 脈象微弱</label><br>
      <button type="button" onclick="previousStep()">上一步</button>
      <button type="button" onclick="showPage(6)">判斷病症</button>
      
    </form>


  </section>

  <section id="page6" class="page" style="display:none;">
    <div class="page" id="doctorPage" style="display: none;">
      <h2>病患資料總覽</h2>
      <p class="subdevise">以下結果為系統推論僅供參考</p>
      <div id="summaryTable"></div>
      <div id="suggestedFormula"></div>
    </div>

    <div class="page" id="citizenSummaryPage" style="display: none;">
      <h2>您的體質分析結果</h2>
      <p class="subdevise">以下結果為系統推論僅供參考</p>
      <p class="subheading">結果顯示代表您可能的病症和您符合此病症的吻合度，並提供您此病症建議的湯方</p>
      <div id="summaryTable2"></div>
      <div id="suggestedFormula2"></div>
    </div>

    <button type="button" onclick="previousStep()">上一步</button>
    <button type="button" onclick="clearInputs(); showPage(1)">回首頁</button>

  </section>


<script>

  let isDoctorMode = false;

  function startCitizenSystem() {
    isDoctorMode = false;
    //document.getElementById('mainMenu').style.display = 'none';
    showPage(2);
    updateProgress(2);
  }

  function startDoctorSystem() {
    isDoctorMode = true;
    //document.getElementById('mainMenu').style.display = 'none';
    showPage(2);
    updateProgress(2);
  }


  let basicInfo = {};
  let symptoms = [];
  let pulses = [];
  let currentPage=1;

  function showPage(pageNum) {
    const pages = document.querySelectorAll('.page');
    currentPage=pageNum;
    pages.forEach((p, i) => p.style.display = (i === pageNum - 1) ? 'block' : 'none');
    // 第5頁：民眾顯示「不知道」
    if (pageNum === 5 && !isDoctorMode) {
      const pulseContainer = document.getElementById('pulseForm');
      if (!document.getElementById('unknownPulse')) {
        const unknownOption = document.createElement('label');
        unknownOption.innerHTML = `<input type="checkbox" name="pulse" id="unknownPulse" value="不知道"> 不知道`;
        const pulseContainer = document.getElementById('pulseForm');
        //const buttons = pulseForm.querySelector('button');
        const lastCheckbox = pulseForm.querySelectorAll('label:last-of-type')[0]
        // 插入到 pulseContainer 的第一個子元素前
        lastCheckbox.after(unknownOption);
        
        //pulseContainer.appendChild(unknownOption);
      }
    }

    // 第6頁：醫師專屬
    if (pageNum === 6 && isDoctorMode) {
      renderDoctorPage();
    }
    // 第6頁：醫師專屬
    else if (pageNum === 6 && !isDoctorMode) {
      renderCitizenPage();
    }
    document.getElementById('stepTracker').style.display = pageNum === 1 ? 'none' : 'flex';
    updateProgress(pageNum);
    //updateProgress(pageNum);
  }

  function clearInputs() {
    // 清除所有 checkbox、radio、text、textarea、select 等欄位
    const formElements = document.querySelectorAll('input, textarea, select');

    formElements.forEach(el => {
        if (el.type === 'checkbox' || el.type === 'radio') {
            el.checked = false;
        } else if (el.tagName === 'SELECT') {
            el.selectedIndex = 0; // 回到第一個選項
        } else {
            el.value = ''; // 清除文字欄位
        }
    });
  }


  function updateProgress(step) {
    for (let i = 1; i <= 5; i++) {
      const circle = document.getElementById(`step${i}`);
      const line = document.getElementById(`line${i - 1}`);
      if (i <= step) {
        circle.classList.add('active');
        if (line) line.classList.add('active');
      } else {
        circle.classList.remove('active');
        if (line) line.classList.remove('active');
      }
    }
  }

  function nextStep() {
    if (currentPage ===1) {
      submitBasicInfo();
    } else if (currentPage === 3) {
      document.getElementById('diagnosisForm').dispatchEvent(new Event('submit'));
    } else if (currentPage === 5) {
      diagnose();
      showPage(currentPage + 1);
    }
    
  }

  function previousStep() {
    if (currentPage > 1) {
      showPage(currentPage - 1);
    }
  }


  function submitBasicInfo() {
    const form = document.getElementById('basicInfoForm');
    if (!form.checkValidity()) {
      alert("請完整填寫基本資料！");
      return;
    }
    basicInfo = {
      gender: form.gender.value,
      age: form.age.value,
      medHistory: form.medHistory.value
    };
    showPage(3);
  }

  // 取第4頁症狀
  document.getElementById('diagnosisForm').addEventListener('submit', function(e) {
    e.preventDefault();
    symptoms = Array.from(this.symptom)
                    .filter(chk => chk.checked)
                    .map(chk => chk.value);
    if(symptoms.length === 0) {
      alert("請至少勾選一項症狀");
      return;
    }
    showPage(5);
  });

  // 第5頁脈象與診斷判斷
  function diagnose() {
    const pulseForm = document.getElementById('pulseForm');
    pulses = Array.from(pulseForm.pulse)
                  .filter(chk => chk.checked)
                  .map(chk => chk.value);
    if(pulses.length === 0) {
      alert("請勾選至少一項脈象");
      return;
    }
    
    // 邏輯還未寫
    let diagnosis = "未能判斷。";
    if (symptoms.includes("發熱") && pulses.includes("浮脈")) {
      diagnosis = "可能為風熱感冒。建議飲用銀翹解毒湯。";
    } else if (symptoms.includes("惡寒") && pulses.includes("沉脈")) {
      diagnosis = "可能為風寒感冒。建議飲用麻黃湯。";
    } else {
      diagnosis = "症狀與脈象複雜，建議進一步診察。";
    }

    document.getElementById('pulseResult').innerHTML = `<h2>可能的病症</h2><p>${diagnosis}</p>`;
  }

  function renderDoctorPage() {
    // 1. 收集使用者輸入的資料
    const age = document.querySelector('input[name="age"]').value;
    const gender = document.querySelector('select[name="gender"]')?.value || '未選擇';
    const medHistory=document.querySelector('textarea[name="medHistory"]')?.value.trim() || '未填寫';
    const pulse = document.querySelector('input[name="pulse"]:checked')?.value || '未填寫';
    const symptoms = Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(el => el.value);

    // 2. 建立資料表格
    const summary = `
      <table border="1" cellpadding="5">
        <tr><th>性別</th><td>${gender}</td></tr>
        <tr><th>年齡</th><td>${age}</td></tr>
        <tr><th>用藥史</th><td>${medHistory}</td></tr>
        <tr><th>脈象</th><td>${pulse}</td></tr>
        <tr><th>症狀</th><td>${symptoms.length > 0 ? symptoms.join(', ') : '未填寫'}</td></tr>
      </table>
    `;

    // 3. 根據症狀匹配湯方
    const matches = patterns.map(pattern => {
        const matchedSymptoms = pattern.symptoms.filter(symptom => symptoms.includes(symptom));
        const matchRate = matchedSymptoms.length / pattern.symptoms.length;
        return { ...pattern, matchRate };
    }).filter(pattern => pattern.matchRate >= 0.5);


    //let formula = "暫無建議湯方";
    //let condition = "無法判斷，請諮詢中醫師";
    //let ingredients = "";
    let suggestionHTML = "<h3>建議湯方</h3>";
    if (matches.length>0) {
      matches.forEach((match, index) => {
        const formula = match.formula;
        const condition = match.name;
        const matchPercentage = Math.round(match.matchRate * 100);
        //hello
        //hello1
        //Alvin1587536
        //林怡勳
        // 假設湯方配方(要新增，和1140相同)
        //加入湯方(要刪掉)
        const formulaIngredients = {
            "桂枝湯": ["桂枝", "白芍", "甘草", "生薑", "大棗"],
            "麻黃湯": ["麻黃", "桂枝", "杏仁", "甘草"],
            "白虎湯": ["石膏", "知母", "甘草", "粳米"],
            "理中湯": ["人參", "白朮", "甘草", "乾薑"],
            "葛根湯": ["葛根", "麻黃", "桂枝", "芍藥", "甘草", "生薑", "大棗"],
            "小青龍湯": ["麻黃", "桂枝", "芍藥", "甘草", "乾薑", "細辛", "五味子", "半夏"],
            "大承氣湯": ["大黃", "厚朴", "枳實", "芒硝"],
            "小承氣湯": ["大黃", "厚朴", "枳實"],
            "陽旦湯": ["桂枝", "芍藥", "甘草", "生薑", "大棗", "黃芩"],
            "桃核承氣湯": ["大黃", "芒硝", "甘草", "桃核", "桂枝"],
            "抵當湯": ["大黃", "桃仁", "水蛭", "虻蟲"],
            "大陷胸湯": ["大黃", "芒硝", "甘遂"],
            "十棗湯": ["大棗", "甘遂", "芫花", "大戟"],
            "梔子豉湯": ["梔子", "豆豉"],
            "茵陳蒿湯": ["梔子", "大黃", "茵陳蒿"],
            "梔子柏皮湯": ["梔子", "黃柏", "甘草"],
            "梔子厚朴湯": ["梔子", "厚朴", "枳實"],
            "梔子乾薑湯": ["梔子", "乾薑"],
            "小柴胡湯": ["柴胡", "黃苓", "人參", "半夏", "甘草", "大棗", "生薑"],
            "大柴胡湯": ["柴胡", "黃苓", "半夏", "大棗", "生薑", "枳實", "芍藥", "大黃"],
            "黃芩湯": ["黃苓", "芍藥", "甘草", "大棗"],
            "黃連湯": ["黃連", "桂枝", "甘草", "乾薑", "半夏", "大棗", "人參"],
            "四逆湯": ["柴胡", "芍藥", "枳實", "甘草"],
            "瓜蒂散": ["瓜蒂", "赤小豆", "香豉"]
        };

        const ingredients = formulaIngredients[formula]?.join(", ") || "無配方資料";
        // 副湯方配方(要新增，和1170相同)
        //加入副湯方(要刪掉)
        const adjunctFormulas2 = {
          "桂枝湯": [
            { condition: "若脖子與背部緊繃、僵硬、不舒適、低頭抬頭都不靈", adjunct: "葛根湯" },
            { condition: "若呼吸急促、氣逆、咳喘等症狀", adjunct: "樸杏湯" },
            { condition: "胸部悶滿", adjunct: "「去」芍藥湯"},
            { condition: "汗出不斷、小便困難而不暢、四肢微急，難以屈伸", adjunct: "附子湯"},
            { condition: "怕冷，甚至風吹就發抖，不易取暖", adjunct: "「去」芍藥加附子湯"},
            { condition: "服桂枝湯後，寒熱交替，一天發作兩次", adjunct: "麻黃湯(桂枝二麻黃一湯)"},
            { condition: "面部出紅、身體有瘙癢的感覺、感到非常怕冷", adjunct: "麻黃湯(桂枝麻黃各半湯)"},
            { condition: "頭項部強痛、持續微微發熱、沒有發汗、小便不太順", adjunct: "茯苓白朮湯"},
            { condition: "發熱怕冷，熱多寒少", adjunct: "越婢湯(桂枝二越婢一湯)"}
          ],
          "葛根湯": [
            { condition: "若沒有腹瀉，而有嘔吐", adjunct: "半夏湯" },
            { condition: "曾服用腹瀉藥，導致氣喘、出汗、腹瀉不止、口渴", adjunct: "黃芩黃連湯" }
          ],
          "梔子豉湯": [
            { condition: "心悸，不寐", adjunct: "甘草" },
            { condition: "嘔吐，胃中不和(消化不良、食欲不振、脘腹脹悶)", adjunct: "生薑" },
            { condition: "胃中不和(消化不良、食欲不振、脘腹脹悶)", adjunct: "枳實" },
            { condition: "大便秘結(糞便乾硬，排便困難)", adjunct: "枳實、大黃湯" }
          ],
          "小柴胡湯": [
            { condition: "大便不通", adjunct: "芒硝" },
            { condition: "發熱、頭痛、項強(頸部僵硬)", adjunct: "桂枝、芍藥" },
            { condition: "發熱、頭痛、項強", adjunct: "枳實、大黃湯" }
          ],
          "黃芩湯": [
            { condition: "想嘔吐或反胃，胸部與肋間部感覺不舒適、悶痛", adjunct: "薑半湯(生薑、半夏)" }
        
          ]
        };

        let adjunctHTML2 = "";
        if (adjunctFormulas2[formula]) {
          adjunctHTML2 = `
            <div id="adjunct-${index}" class="adjunct" style="display:none; margin-top:5px;">
              ${adjunctFormulas2[formula]
                .map(item => `<p>◆ ${item.condition}，可加入 <strong><em>${item.adjunct}</em></strong>。</p>`)
                .join("")}
            </div>`;
        }
        
        // 4. 顯示建議湯方
        suggestionHTML += `
          <div style="border-left: 3px solid #007bff; padding-left: 10px; margin-top: 10px;">
            <p><strong>病症分類：</strong> ${condition}(${matchPercentage}% 匹配)</p>
            <p><strong>湯方：</strong> ${formula}</p>
            <p><strong>配方：</strong> ${ingredients}</p>
            ${adjunctHTML2
              ? `<button onclick="toggleAdjunct('adjunct-${index}', this)" style="cursor:pointer;background:none;border:none;color:#007bff;">&#9660; 顯示輔湯建議</button>${adjunctHTML2}`
              : ""}
          </div>
        `;
      });
    } else {
        suggestionHTML += "<p>暫無建議湯方，請諮詢中醫師。</p>";
    }
    document.getElementById('suggestedFormula').innerHTML = suggestionHTML;

    document.getElementById('summaryTable').innerHTML = summary;
    document.getElementById('doctorPage').style.display = 'block';
  }

  function renderCitizenPage() {


    // 1. 收集使用者輸入的資料
    const age = document.querySelector('input[name="age"]').value;
    const gender = document.querySelector('select[name="gender"]')?.value || '未選擇';
    const pulse = document.querySelector('input[name="pulse"]:checked')?.value || '未填寫';
    const symptoms = Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(el => el.value);

    // 2. 建立資料表格
    const summaryHTML = `
      <table border="1" cellpadding="5">
        <tr><th>性別</th><td>${gender}</td></tr>
        <tr><th>年齡</th><td>${age}</td></tr>
        <tr><th>脈象</th><td>${pulse}</td></tr>
        <tr><th>症狀</th><td>${symptoms.length > 0 ? symptoms.join(', ') : '未填寫'}</td></tr>
      </table>
    `;
    document.getElementById('summaryTable2').innerHTML = summaryHTML;
    //console.log("勾選的症狀：", selected);

    // 3. 根據症狀匹配湯方
    const matches = patterns.map(pattern => {
        const matchedSymptoms = pattern.symptoms.filter(symptom => symptoms.includes(symptom));
        const matchRate = matchedSymptoms.length / pattern.symptoms.length;
        return { ...pattern, matchRate };
    }).filter(pattern => pattern.matchRate >= 0.5);


    //let formula = "暫無建議湯方";
    //let condition = "無法判斷，請諮詢中醫師";
    //let ingredients = "";
    let suggestionHTML2 = "<h3>建議湯方</h3>";
    if (matches.length>0) {
      matches.forEach((match, index) => {
        const formula = match.formula;
        const condition = match.name;
        const matchPercentage = Math.round(match.matchRate * 100);
        // 假設湯方配方
        //加入湯方(要刪掉)
        const formulaIngredients = {
            "桂枝湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑"],
            "桂枝加桂湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑"],
            "桂枝加芍藥湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑"],
            "桂枝加大黃湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑", "大黃"],
            "桂枝加朴杏湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑", "厚朴", "杏仁"],
            "桂枝加附子湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑", "附子"],
            "桂枝去芍藥湯": ["桂枝", "甘草", "大棗", "生薑"],
            "桂枝去芍藥加附子湯": ["桂枝", "甘草", "大棗", "生薑", "附子"],
            "桂枝去芍藥加龍牡救逆湯": ["桂枝", "甘草", "大棗", "生薑", "蜀漆", "龍骨", "牡蠣"],
            "桂甘龍牡湯": ["桂枝", "甘草", "龍骨", "牡蠣"],
            "桂枝人參湯": ["桂枝", "甘草", "人參", "白朮", "乾薑"],
            "桂枝附子湯": ["桂枝", "甘草", "大棗", "生薑", "附子"],
            "白朮附子湯": ["甘草", "大棗", "生薑", "附子", "白朮"],
            "桂枝去桂加苓朮湯": ["芍藥", "甘草", "大棗", "生薑", "茯苓"],
            "桂枝新加湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑", "人參"],
            "陽旦湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑", "黃芩"],
            "陰旦湯": ["桂枝", "芍藥", "甘草", "大棗", "生薑", "乾薑"],
            "麻黃湯": ["麻黃", "桂枝", "甘草", "杏仁"],
            "大青龍湯": ["麻黃", "桂枝", "甘草", "杏仁", "生薑", "大棗", "石膏"],
            "小青龍湯": ["麻黃", "桂枝", "甘草", "芍藥", "乾薑", "細辛", "五味子", "半夏"],
            "桂麻各半湯": ["麻黃", "桂枝", "甘草", "芍藥", "杏仁", "大棗", "生薑"],
            "桂二麻一湯": ["麻黃", "桂枝", "甘草", "芍藥", "杏仁", "大棗"],
            "桂二越一湯": ["麻黃", "桂枝", "甘草", "芍藥", "大棗", "石膏"],
            "麻黃附子細辛湯": ["麻黃", "附子", "細辛"],
            "麻黃附子甘草湯": ["麻黃", "附子", "甘草"],
            "麻杏石甘湯": ["麻黃", "杏仁", "甘草", "石膏"],
            "麻黃連軺赤小豆湯": ["麻黃", "杏仁", "甘草", "赤小豆", "連軺", "梓白皮", "大棗", "生薑"],
            "葛根湯": ["葛根", "麻黃", "桂枝", "芍藥", "甘草", "大棗", "生薑"],
            "葛根加半夏湯": ["葛根", "麻黃", "桂枝", "芍藥", "甘草", "大棗", "生薑", "半夏"],
            "葛根芩連湯": ["葛根", "黃芩", "黃連", "甘草"],
            "桂枝加葛根湯": ["葛根", "桂枝", "芍藥", "甘草", "大棗", "生薑"],
            "白虎湯": ["石膏", "知母", "梗米", "甘草"],
            "白虎加人參湯": ["石膏", "知母", "梗米", "甘草", "人參"],
            "竹葉石膏湯": ["石膏", "梗米", "甘草", "人參", "麥冬", "竹葉", "半夏"],
            "調胃承氣湯": ["大黃", "芒硝", "甘草"],
            "小承氣湯": ["大黃", "厚朴", "枳實"],
            "大承氣湯": ["大黃", "厚朴", "枳實", "芒硝"],
            "桃核承氣湯": ["大黃", "芒硝", "甘草", "桃核", "桂枝"],
            "抵當湯": ["大黃", "桃仁", "水蛭", "虻蟲"],
            "大陷胸湯": ["大黃", "芒硝", "甘遂"],
            "小陷胸湯": ["黃連", "半夏", "栝簍實"],
            "十棗湯": ["大棗", "甘遂", "芫花", "大戟"],
            "梔子豉湯": ["梔子", "豆豉"],
            "梔子甘草豉湯": ["梔子", "豆豉", "甘草"],
            "梔子生薑豉湯": ["梔子", "豆豉", "生薑"],
            "梔子厚朴湯": ["梔子", "厚朴", "枳實"],
            "梔子乾薑湯": ["梔子", "乾薑"],
            "梔子柏皮湯": ["梔子", "黃柏", "甘草"],
            "茵陳蒿湯": ["梔子", "大黃", "茵陳蒿"],
            "枳實梔豉湯": ["梔子", "豆豉", "枳實"],
            "枳實梔豉加大黃湯": ["梔子", "豆豉", "枳實", "大黃"],
            "小柴胡湯": ["柴胡", "黃芩", "人參", "半夏", "甘草", "大棗", "生薑"],
            "大柴胡湯": ["柴胡", "黃芩", "半夏", "大棗", "生薑", "枳實", "芍藥", "大黃"],
            "柴胡加芒硝湯": ["柴胡", "黃芩", "人參", "半夏", "甘草", "大棗", "生薑", "芒硝"],
            "柴胡桂枝湯": ["柴胡", "黃芩", "人參", "半夏", "甘草", "大棗", "生薑", "桂枝", "芍藥"],
            "柴胡桂枝乾薑湯": ["柴胡", "黃芩", "乾薑", "桂枝", "甘草", "栝簍根", "牡蠣"],
            "柴胡龍牡湯": ["柴胡", "半夏", "茯苓", "桂枝", "大黃", "龍骨", "牡蠣", "鉛丹", "人參", "大棗", "生薑"],
            "黃芩湯": ["黃芩", "芍藥", "甘草", "大棗"],
            "黃芩加薑半湯": ["黃芩", "芍藥", "甘草", "大棗", "生薑", "半夏"],
            "大黃黃連瀉心湯": ["黃連", "大黃"],
            "附子瀉心湯": ["黃連", "大黃", "黃芩", "附子"],
            "甘草瀉心湯": ["黃連", "黃芩", "甘草", "乾薑", "半夏", "大棗"],
            "半夏瀉心湯": ["黃連", "黃芩", "甘草", "乾薑", "半夏", "大棗", "人參"],
            "生薑瀉心湯": ["黃連", "黃芩", "甘草", "乾薑", "半夏", "大棗", "人參", "生薑"],
            "乾薑芩連人參湯": ["黃連", "黃芩", "乾薑", "人參"],
            "黃連湯": ["黃連", "桂枝", "甘草", "乾薑", "半夏", "大棗", "人參"],
            "旋覆代赭石湯": ["旋覆花", "甘草", "代赭石", "半夏", "大棗", "人參", "生薑"],
            "四逆湯": ["附子", "甘草", "乾薑"],
            "通脈四逆湯": ["附子", "甘草", "乾薑", "蔥"],
            "通脈四逆加豬膽汁湯": ["附子", "甘草", "乾薑", "豬膽汁"],
            "乾薑附子湯": ["附子", "乾薑"],
            "四逆加人參湯": ["附子", "甘草", "乾薑", "人參"],
            "茯苓四逆湯": ["附子", "甘草", "乾薑", "人參", "茯苓"],
            "附子湯": ["附子", "白朮", "芍藥", "人參", "茯苓"],
            "真武湯": ["附子", "白朮", "芍藥", "生薑", "茯苓"],
            "白通湯": ["附子", "乾薑", "蔥白"],
            "白通加尿膽湯": ["附子", "乾薑", "蔥白", "人尿", "豬膽汁"],
            "當歸四逆湯": ["當歸", "桂枝", "芍藥", "甘草", "通草", "細辛", "大棗"],
            "當歸四逆加茱薑湯": ["當歸", "桂枝", "芍藥", "甘草", "通草", "細辛", "大棗", "吳茱萸", "生薑"],
            "甘草湯": ["甘草"],
            "桔梗湯": ["甘草", "桔梗"],
            "桂枝甘草湯": ["甘草", "桂枝"],
            "甘草乾薑湯": ["甘草", "甘薑"],
            "芍藥甘草湯": ["甘草", "芍藥"],
            "芍藥甘草附子湯": ["甘草", "芍藥", "附子"],
            "甘草附子湯": ["甘草", "桂枝", "附子", "白朮"],
            "茯苓甘草湯": ["甘草", "桂枝", "茯苓", "生薑"],
            "苓桂甘棗湯": ["甘草", "桂枝", "茯苓", "大棗"],
            "苓桂朮甘湯": ["甘草", "桂枝", "茯苓", "白朮"],
            "厚朴薑夏甘參湯": ["甘草", "厚朴", "生薑", "半夏", "人參"],
            "小建中湯": ["甘草", "桂枝", "芍藥", "大棗", "生薑", "膠飴"],
            "灸甘草湯": ["甘草", "桂枝", "人參", "大棗", "生薑", "生地", "阿膠", "清酒", "麻子仁"],
            "理中丸湯": ["甘草", "乾薑", "人參", "白朮"],
            "烏梅丸": ["烏梅", "乾薑", "人參", "細辛", "黃連", "黃柏", "當歸", "附子", "蜀椒", "桂枝", "苦酒"],
            "麻仁丸": ["大黃", "厚朴", "枳實", "麻子仁", "芍藥", "杏仁"],
            "蜜煎導": ["蜜"],
            "豬膽汁導": ["豬膽"],
            "土瓜根方": ["土瓜"],
            "抵當丸": ["大黃", "桃仁", "水蛭", "虻蟲"],
            "大陷胸丸": ["大黃", "甘遂", "杏仁", "葶藶子", "芒硝", "蜜"],
            "五苓散": ["茯苓", "豬苓", "澤瀉", "白朮", "桂"],
            "文蛤散": ["文蛤"],
            "三物白散": ["桔梗", "巴豆", "貝母"],
            "半夏湯及散": ["半夏", "桂枝"],
            "四逆湯": ["柴胡", "芍藥", "枳實", "甘草"],
            "瓜蒂散": ["瓜蒂", "赤小豆", "香豉"],
            "牡蠣澤瀉散": ["牡蠣", "澤瀉", "括蔞根", "蜀漆", "商陸", "海藻", "葶藶"],
            "燒焜散": ["燒焜灰"],
            "赤石脂余餘糧湯": ["赤石脂", "余餘糧"],
            "桃花湯": ["赤石脂", "乾薑", "糯米"],
            "豬苓散": ["茯苓", "豬苓", "澤瀉", "滑石", "阿膠"],
            "吳茱萸湯": ["吳茱萸", "人參", "大棗", "生薑"],
            "麻黃升麻湯": ["麻黃", "升麻", "當歸", "知母", "黃芩", "萎蕤", "石膏", "白朮", "乾薑", "芍藥", "天冬", "桂枝", "茯苓", "甘草"],
            "黃連阿膠湯": ["黃連", "黃芩", "芍藥", "雞子黃", "阿膠"],
            "苦酒湯": ["苦酒", "半夏", "雞子白"],
            "豬膚湯": ["豬膚", "蜜", "白粉"],
            "白頭翁湯": ["白頭翁", "秦皮", "黃柏", "黃連"]
        };

        const ingredients = formulaIngredients[formula]?.join(", ") || "無配方資料";
        //加入副湯方(要刪掉)
        const adjunctFormulas = {
          "桂枝湯": [
            { condition: "若脖子與背部緊繃、僵硬、不舒適、低頭抬頭都不靈", adjunct: "葛根湯" },
            { condition: "若呼吸急促、氣逆、咳喘等症狀", adjunct: "樸杏湯" },
            { condition: "胸部悶滿", adjunct: "「去」芍藥湯"},
            { condition: "汗出不斷、小便困難而不暢、四肢微急，難以屈伸", adjunct: "附子湯"},
            { condition: "怕冷，甚至風吹就發抖，不易取暖", adjunct: "「去」芍藥加附子湯"},
            { condition: "服桂枝湯後，寒熱交替，一天發作兩次", adjunct: "麻黃湯(桂枝二麻黃一湯)"},
            { condition: "面部出紅、身體有瘙癢的感覺、感到非常怕冷", adjunct: "麻黃湯(桂枝麻黃各半湯)"},
            { condition: "頭項部強痛、持續微微發熱、沒有發汗、小便不太順", adjunct: "茯苓白朮湯"},
            { condition: "發熱怕冷，熱多寒少", adjunct: "越婢湯(桂枝二越婢一湯)"}
          ],
          "葛根湯": [
            { condition: "若沒有腹瀉，而有嘔吐", adjunct: "半夏湯" },
            { condition: "曾服用腹瀉藥，導致氣喘、出汗、腹瀉不止、口渴", adjunct: "黃芩黃連湯" }
          ],
          "梔子豉湯": [
            { condition: "心悸，不寐", adjunct: "甘草" },
            { condition: "嘔吐，胃中不和(消化不良、食欲不振、脘腹脹悶)", adjunct: "生薑" },
            { condition: "胃中不和(消化不良、食欲不振、脘腹脹悶)", adjunct: "枳實" },
            { condition: "大便秘結(糞便乾硬，排便困難)", adjunct: "枳實、大黃湯" }
          ],
          "小柴胡湯": [
            { condition: "大便不通", adjunct: "芒硝" },
            { condition: "發熱、頭痛、項強(頸部僵硬)", adjunct: "桂枝、芍藥" },
            { condition: "發熱、頭痛、項強", adjunct: "枳實、大黃湯" }
          ],
          "黃芩湯": [
            { condition: "想嘔吐或反胃，胸部與肋間部感覺不舒適、悶痛", adjunct: "薑半湯(生薑、半夏)" }
        
          ]
        };

        /* 你原來的配方 map … */

        // ---------- 動態組裝多組輔湯 ----------
        let adjunctHTML = "";
        if (adjunctFormulas[formula]) {
          adjunctHTML = `
            <div id="adjunct-${index}" class="adjunct" style="display:none; margin-top:5px;">
              ${adjunctFormulas[formula]
                .map(item => `<p>◆ ${item.condition}，可加入 <strong><em>${item.adjunct}</em></strong>。</p>`)
                .join("")}
            </div>`;
        }

        // 4. 顯示建議湯方
        suggestionHTML2 += `
          <div style="border-left: 3px solid #007bff; padding-left: 10px; margin-top: 10px;">
            <p><strong>病症分類：</strong> ${condition}(${matchPercentage}% 匹配)</p>
            <p><strong>湯方：</strong> ${formula}</p>
            <p><strong>配方：</strong> ${ingredients}</p>
            ${adjunctHTML
              ? `<button onclick="toggleAdjunct('adjunct-${index}', this)" style="cursor:pointer;background:none;border:none;color:#007bff;">&#9660; 顯示輔湯建議</button>${adjunctHTML}`
              : ""}
          </div>`;
      });
    } else {
        suggestionHTML2 += "<p>暫無建議湯方，請諮詢中醫師。</p>";
    }
    document.getElementById('suggestedFormula2').innerHTML = suggestionHTML2;
    //document.getElementById('suggestedFormula').style.display = 'block';
    document.getElementById('citizenSummaryPage').style.display = 'block';
  }


  function goToNextStep(currentPage) {
    if (currentPage === 5) {
      if (isDoctorMode) {
        showPage(6);
        updateProgress(6); // 你可新增 step5
      } else {
        diagnose();
      }
    } else {
      showPage(currentPage + 1);
      updateProgress(currentPage + 1);
    }
  }

  function toggleAdjunct(id, btn) {
    const div = document.getElementById(id);
    const isHidden = div.style.display === "none";
    div.style.display = isHidden ? "block" : "none";
    btn.innerHTML     = isHidden ? "&#9650; 收起輔湯建議" : "&#9660; 顯示輔湯建議";
  }

  
 function toggleTooltip(button) {
    const wrapper = button.parentElement;

    // 關閉所有其他 tooltip
    document.querySelectorAll('.tooltip-wrapper.active').forEach(activeWrapper => {
        if (activeWrapper !== wrapper) {
            activeWrapper.classList.remove('active');
        }
    });

    // 切換當前 tooltip 顯示狀態
    wrapper.classList.toggle('active');
  }


  document.addEventListener('click', function(e) {
    if (!e.target.closest('.tooltip-wrapper')) {
      document.querySelectorAll('.tooltip-wrapper').forEach(wrapper => {
        wrapper.classList.remove('active');
      });
    }
  });
//加入勾選疾病及配對湯方(要刪掉)
  const patterns = [
    { name: "太陽中風證", symptoms: ["發熱", "惡風", "汗出", "頭痛"], formula: "桂枝湯" },
    { name: "太陽傷寒", symptoms: ["發熱", "無汗", "惡寒"], formula: "麻黃湯" },
    { name: "太陽與陽明兩經合病", symptoms: ["惡寒", "無汗", "下利"], formula: "葛根湯" },
    { name: "少陽證", symptoms: ["寒熱往來", "胸脅苦滿", "心煩", "不能進食", "口苦", "咽燥", "目眩"], formula: "小柴胡湯" },
    { name: "少陽與陽明合病", symptoms: ["寒熱往來", "胸脅苦滿", "吐利", "心下急", "大便困難", "腹中痛"], formula: "大柴胡湯" },
    { name: "太陽傷寒證", symptoms: ["乾嘔", "發熱", "咳嗽", "口渴", "下利","噎氣證", "小便不利", "少腹脹滿證", "氣喘"], formula: "小青龍湯" },
    { name: "太陽傷寒證", symptoms: ["發熱", "咳嗽", "氣喘"], formula: "小青龍湯" },
    { name: "陽旦證", symptoms: ["頭痛", "惡寒", "發熱", "乾嘔", "汗出"], formula: "陽旦湯" },
    { name: "陽明兼少陽、太陽三陽合病", symptoms: ["少腹脹滿證", "言語不利", "不知食味", "譫語", "遺尿", "自汗"], formula: "白虎湯" },
    { name: "陽明病", symptoms: ["譫語", "潮熱", "不能進食"], formula: "大承氣湯" },
    { name: "陽明病", symptoms: ["譫語", "潮熱"], formula: "小承氣湯" },
    { name: "血瘀下焦證", symptoms: ["少腹急結", "如狂", "經水適來", "夜熱而渴", "腹中痛", "小便不利", "譫語"], formula: "桃核承氣湯" },
    { name: "血瘀下焦證", symptoms: ["發狂", "少腹鞕滿", "小便自利", "下血乃愈"], formula: "抵當湯" },
    { name: "結胸證", symptoms: ["心下鞕痛", "氣喘", "心煩", "小便不利"], formula: "大陷胸湯" },
    { name: "小結胸病", symptoms: ["心下按之則痛", "胸中痞滿"], formula: "小陷胸湯" },
    { name: "太陽中風證", symptoms: ["汗出", "頭痛", "心下痞鞕滿", "引脅下痛", "乾嘔", "氣喘", "不惡寒"], formula: "十棗湯" },
    { name: "陽明病", symptoms: ["咽燥", "口苦", "腹滿", "氣喘", "發熱", "汗出", "不惡寒", "反惡熱", "身重", "心煩"], formula: "梔子豉湯" },
    { name: "陽明腑實證", symptoms: ["心煩", "腹滿", "臥起不安"], formula: "梔子厚朴湯" },
    { name: "陽明腑實證", symptoms: ["身熱不去", "心煩"], formula: "梔子乾薑湯" },
    { name: "陽黃型濕熱證", symptoms: ["身黃", "發熱"], formula: "梔子柏皮湯" },
    { name: "陽黃型濕熱證", symptoms: ["身目發黃", "發熱", "小便不利"], formula: "茵陳蒿湯" },
    { name: "少陽病", symptoms: ["下利", "肛門灼熱", "腹中痛"], formula: "黃芩湯" },
    { name: "寒熱錯雜", symptoms: ["胸中煩熱", "吐利", "下利"], formula: "黃連湯" },
    { name: "少陰病", symptoms: ["汗出", "身熱不去", "內拘急", "四肢疼", "下利", "厥逆", "惡寒", "厥冷"], formula: "四逆湯" },
    { name: "結胸證", symptoms: ["厥冷", "胸中煩熱", "心煩", "不能進食"], formula: "瓜蒂散" },
  ];

  document.getElementById('diagnosisForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const selected = Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(el => el.value);
    const results = [];

    patterns.forEach(pattern => {
      const total = pattern.symptoms.length;
      const matchCount = pattern.symptoms.filter(s => selected.includes(s)).length;
      const probability = Math.round((matchCount / total) * 100);

      if (probability >= 50) {
        results.push({ ...pattern, probability });
      }
    });

    results.sort((a, b) => b.probability - a.probability);

    const resultBox = document.getElementById('resultText');
    if (results.length > 0) {
      let html = "<ul>";
      results.forEach(r => {
        html += `<li><strong>${r.name}</strong>（吻合度${r.probability}%）：建議湯方為 <strong>${r.formula}</strong></li>`;
      });
      html += "</ul>";
      resultBox.innerHTML = html;
    } else {
      resultBox.innerHTML = `<p>無法判斷明確證型（各證型吻合度皆低於 50%）。</p>`;
    }
  });
</script>

</body>
</html>
